language: r

env:
- WARNINGS_ARE_ERRORS=1

install:
  - sudo apt-get install texlive-xetex

r_binary_packages:
  - knitr
  - RCurl

r_github_packages:
  - hadley/devtools
  - rstudio/rmarkdown
  - hadley/bookdown

script:
  - xelatex -version
  - pandoc --version
  - pandoc-citeproc --version

  # Install inconsolata
  - sudo apt-get install fonts-inconsolata
  - sudo fc-cache -fv

  # Create PDF file
  - Rscript  'report/build-report.r'

after_failure:
- "./travis-tool.sh dump_logs"

deploy:
  provider: s3
  access_key_id: AKIAJXAGPD4HZ5IORX2Q
  secret_access_key:
    secure: gaZ9Ds61sQwp0yG5wS5LGA1/DYCzbQyiW/rvsaw3GWLbK/QZhByoki+TqEvW+/DGBShQ3Sc4+ZIpQdOCwZ9OIMRG/Tu8GHxJX2fSheW5soH5l5Pm78SUoAIw+d53wDaIfM12xye05L1HVjrmWqID7Hhn+p1U1znKr9k5I4in1Jo=
  bucket: r-pkgs.had.co.nz
  endpoint: io.github.niranjv.s3-website-us-east-1.amazonaws.com
  upload-dir: ucscamsms2015
  local_dir: report
  detect_encoding: true
  skip_cleanup: true

notifications:
  email:
    on_success: change
    on_failure: change
